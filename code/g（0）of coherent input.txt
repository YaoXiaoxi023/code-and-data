import numpy as np
import matplotlib.pyplot as plt
import qutip as qt
from matplotlib.ticker import MultipleLocator, FormatStrFormatter

# è®¾ç½®å‚æ•°
g = 0.01
c = 0.001
N = 50
alphas = np.linspace(0.01, 5, 200)

# ç®—ç¬¦å®šä¹‰
a = qt.destroy(N)
n_op = a.dag() * a
n_op_1 = a.dag()**2 * a**2

# å‚¨å­˜ g2(0) å€¼
g2_vals_1 = []  # å¾®æ‰°æ€
g2_vals_2 = []  # SPACS æ€

for alpha in alphas:
    # æ€ 1ï¼šå¾®æ‰°ä¿®æ­£æ€
    coh_1 = (
        qt.coherent(N, alpha)
        - 1j * alpha * g / 2 * (1 + 1 / c) * qt.create(N) * qt.coherent(N, alpha)
    ).unit()

    # æ€ 2ï¼šSPACS
    coh_2 = (qt.create(N) * qt.coherent(N, alpha)).unit()

    # è®¡ç®— g^(2)(0)
    g2_1 = qt.expect(n_op_1, coh_1) / (qt.expect(n_op, coh_1) ** 2)
    g2_2 = qt.expect(n_op_1, coh_2) / (qt.expect(n_op, coh_2) ** 2)

    g2_vals_1.append(g2_1)
    g2_vals_2.append(g2_2)

# ğŸŒˆ ç»˜å›¾éƒ¨åˆ†
fig, ax = plt.subplots(figsize=(8, 5.5))

# æ›²çº¿
ax.plot(alphas, g2_vals_1, label=r'Output state $\left|\Phi\right\rangle$', color='tab:blue', linewidth=2)


ax.plot(alphas, g2_vals_2, label=r'SPACS $(\hat{b}^\dagger|\beta\rangle)$',
        color='tab:green', linestyle='--', linewidth=2)

ax.axhline(1, color='red', linestyle='--', linewidth=1.5,
           label=r'CS $(|\beta\rangle)$')


# åæ ‡è½´æ ‡ç­¾
ax.set_xlabel(r'$\beta$', fontsize=14)
ax.set_ylabel(r'$g^{(2)}(0)$', fontsize=14)

# è®¾ç½® x/y åˆ»åº¦é—´è·
ax.xaxis.set_major_locator(MultipleLocator(1))   # x è½´ä¸»åˆ»åº¦é—´è· 0.5
ax.yaxis.set_major_locator(MultipleLocator(0.2))   # y è½´ä¸»åˆ»åº¦é—´è· 0.2

# è®¾ç½® x è½´åˆ»åº¦ï¼šåŒ…å« 0.01ï¼Œç„¶åä» 1 åˆ° 5 æ¯éš” 1 ä¸ªå•ä½
xticks = [0.01] + list(np.arange(1, 6, 1))
ax.set_xticks(xticks)
ax.set_xticklabels([f'{x:.2f}' if x == 0.01 else f'{x:.1f}' for x in xticks])


# å›¾ä¾‹ã€ç½‘æ ¼ã€ç¾åŒ–
ax.legend(fontsize=12)
ax.grid(True, alpha=0.3)
ax.set_xlim(alphas[0], alphas[-1])
ax.set_ylim(0, max(max(g2_vals_1), max(g2_vals_2)) * 1.1)

plt.tight_layout()
plt.show()